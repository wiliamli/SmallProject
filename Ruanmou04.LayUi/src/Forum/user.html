
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>用户主页</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/css/layui.css">
  <link rel="stylesheet" href="/css/global.css">
</head>
<body style="margin-top: 65px;">

<div class="fly-header layui-bg-black">
  <div class="layui-container">
    <a class="fly-logo" href="/">
      <img src="../../res/images/logo.png" alt="layui">
    </a>
    <!--
    <ul class="layui-nav fly-nav layui-hide-xs">
      <li class="layui-nav-item layui-this">
        <a href="/"><i class="iconfont icon-jiaoliu"></i>交流</a>
      </li>
      <li class="layui-nav-item">
        <a href="../case/case.html"><i class="iconfont icon-iconmingxinganli"></i>案例</a>
      </li>
      <li class="layui-nav-item">
        <a href="http://www.layui.com/" target="_blank"><i class="iconfont icon-ui"></i>框架</a>
      </li>
    </ul>
    -->
    <script id="topicTpl" type="text/html">
      <h3 class="fly-panel-title">{{d.CreatedBy}} 最近的发帖</h3>
      <ul class="jie-row">
        {{# layui.each(d, function(index, item){ }}
           <li>
                <a href="/src/Forum/detail.html?topic={{item.Id}}" class="jie-title">{{item.Name}}</a>
                <i>{{item.ModifiedDate}}</i>
                <em class="layui-hide-xs">{{item.Conssensus}}赞/{{item.Oppose}}踩</em>
          </li>
        {{#  }); }}
        {{#  if(d.length === 0){ }}
          <div class="fly-none" style="min-height: 50px; padding:30px 0; height:auto;"><i style="font-size:14px;">没有发表任何主题</i></div>
        {{#  } }} 
        </ul>
      </script>

      <script id="replyTpl" type="text/html">
        <h3 class="fly-panel-title">{{d.CreatedBy}} 最近的回帖</h3>
        <ul  class="home-jieda">
        {{# layui.each(d, function(index, item){ }}
        <li>
            <p>
              <span>{{item.CreatedDate}}</span>
              在<a href="/src/Forum/detail.html?topic={{item.TopicId}}" target="_blank">{{item.TopicName}}</a>中回复：
            </p>
            <div class="home-dacontent">
                {{item.Content}}
            </div>
          </li>
         {{#  }); }}
        {{#  if(d.length === 0){ }}
        <div class="fly-none" style="min-height: 50px; padding:30px 0; height:auto;"><span>没有回复任何主题</span></div>
        {{#  } }} 
        <ul>
      </script>

      <script id="userInfoTpl" type="text/html">
        <h1>
          {{d.Name}}
          <!--<i class="iconfont icon-nan"></i>-->
        </h1>
        <p class="fly-home-info">
         <!-- <i class="iconfont icon-shijian"></i><span>{{d.CreateTime}} 加入</span> -->
        </p>
      
        <p class="fly-home-sign">（个人描述）</p>
      </script>

      <script id="loginInfoTpl" type="text/html">
        <li class="layui-nav-item">
            <div style="float:left">
                <a class="fly-nav-avatar" href="/src/forum/user.html?userId={{d.Id}}">
                  <cite class="layui-hide-xs">{{d.Name}}</cite>
                  <span class="layui-nav-more"></span>
                </a>
              </div>
              <div style="float:left">
                <a  class="fly-nav-avatar" href="javascript:logout()">
                  <cite class="layui-hide-xs">退出</cite>
                  <span class="layui-nav-more"></span>
                </a>
              </div>
        </li>
      </script>

    <ul id="loginView" class="layui-nav fly-nav-user">
     
    </ul>
  </div>
</div>

<div id="userInfoView" class="fly-home fly-panel" style="background-image: url();">
 
</div>

<div class="layui-container">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md6 fly-home-jie">
      <div id="userTopicView" class="fly-panel">
        
      </div>
    </div>
    
    <div class="layui-col-md6 fly-home-da">
      <div id="replyUserView" class="fly-panel">
        
      </div>
    </div>
  </div>
</div>

<div class="fly-footer">
    <!--
  <p><a href="http://fly.layui.com/" target="_blank">Fly社区</a> 2017 &copy; <a href="http://www.layui.com/" target="_blank">layui.com 出品</a></p>
  <p>
    <a href="http://fly.layui.com/jie/3147/" target="_blank">付费计划</a>
    <a href="http://www.layui.com/template/fly/" target="_blank">获取Fly社区模版</a>
    <a href="http://fly.layui.com/jie/2461/" target="_blank">微信公众号</a>
  </p>
  -->
</div>

<script src="/src/Forum/api/base.js" charset="utf-8"></script>
<script src="/layui.js" charset="utf-8"></script>
<script type="text/javascript">
layui.use(['layer','jquery','laytpl','form'], function(){
  var $ = layui.jquery
  ,element = layui.element
  ,form = layui.form

  var userId = getQueryVariable("userId");
  var domain = baseDomain();
  var key = "Bearer " +localStorage.getItem("token");
   var loginInfo=function(data){
          var loginInfoTpl=document.getElementById('loginInfoTpl').innerHTML;
          var loginView=document.getElementById('loginView');
          layui.laytpl(loginInfoTpl).render(data,function(html){
          loginView.innerHTML=html;
      });
  }

  var active={
     topicShow:function(){
     $.ajax({
          url:baseDomain()+"api/ForumTopic/GetForumTopicsByUserId",
          data: {"userId":userId},
          type: 'get',
          headers: {token: key},
          dataType: 'json',
          success: function(obj) {
            if(obj.Success){
              var data = obj.Data;
              data.CreatedBy=data[0].CreatedBy;
              var topicTpl=document.getElementById('topicTpl').innerHTML;
              var userTopicView=document.getElementById('userTopicView');
              layui.laytpl(topicTpl).render(data,function(html){
                  userTopicView.innerHTML=html;
              });
            }else{
              window.location.href="/src/Forum/login.html";
            }
          },
          error: function() {
            layer.alert(JSON.stringify(data.field), {
              title: 'ajax请求失败！'});
          }
       });},
      replyShow:function(){
       $.ajax({
          url:baseDomain()+"api/ForumInvitation/GetInvitationsByUserId",
          data: {"userId":userId},
          headers: {token: key},
          type: 'get',
          dataType: 'json',
          success: function(obj) {
            if(obj.Success){
              var data = obj.Data;
              data.CreatedBy=data[0].CreatedBy;
              var replyTpl=document.getElementById('replyTpl').innerHTML;
              var replyUserView=document.getElementById('replyUserView');
              layui.laytpl(replyTpl).render(data,function(html){
                  replyUserView.innerHTML=html;
              });
            }else{
              window.location.href="/src/Forum/login.html";
            }
          },
          error: function() {
            layer.alert(JSON.stringify(data.field), {
              title: 'ajax请求失败！'});
          }
       });
    }
    ,userInfo:function(){
      $.ajax({
          url:baseDomain()+"api/ForumLogin/GetLoginInfo ",
          data: null,
          headers: {token: key},
          type: 'get',
          dataType: 'json',
          contentType:'application/json',
          success: function(obj) {
            if(obj.Success){
              var data = obj.Data;
              var userInfoTpl=document.getElementById('userInfoTpl').innerHTML;
              var userInfoView=document.getElementById('userInfoView');
              layui.laytpl(userInfoTpl).render(data,function(html){
                userInfoView.innerHTML=html;
              });
              loginInfo(data);
            }else{
              window.location.href="/src/Forum/login.html";
            }
          }
       });
    }
   }
   active.topicShow();
   active.replyShow();  
   active.userInfo(); 
});
</script>

</body>
</html>