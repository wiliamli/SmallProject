<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title></title>
  <link href="/css/layui.css" rel="stylesheet" />
</head>

<body>
  <div class="layui-form layui-form-pane1" action="" lay-filter="first">
    <div class="layui-form-item">
      <label class="layui-form-label"></label>
      <div class="layui-input-inline">
        <input type="hidden" name="Id">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">名称</label>
      <div class="layui-input-inline">
        <input type="text" name="Text" lay-verify="required" placeholder="请输入名称" autocomplete="off" class="layui-input">
      </div>
      <div class="layui-form-mid layui-word-aux">请务必填写名称</div>
    </div>
    <div class="layui-form-item" pane>
      <label class="layui-form-label">状态</label>
      <div class="layui-input-block">
        <input type="radio" name="Status" value="1" title="是" checked>
        <input type="radio" name="Status" value="0" title="否">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">备注</label>
      <div class="layui-input-inline">
        <input type="text" name="Description" placeholder="请输入备注" autocomplete="off" style="width:400px;"
          class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <div class="layui-input-block">
        <button class="layui-btn" lay-submit lay-filter="sub">立即提交</button>
        <button onclick="parent.layer.closeAll()" class="layui-btn layui-btn-primary">关闭</button>
      </div>
    </div>
  </div>
  <script src="/layui.js"></script>
  <script type="text/javascript">
    var userDetail = {
      userInIt: function ($, config, form) {
        if (parent.layer.data) {
          $.ajax({
            type: "Get",
            data: {
              id: parent.layer.data
            },
            beforeSend: function (XHR) {
              XHR.setRequestHeader("Authorization", "Bearer " + sessionStorage.getItem("apiTicket"));
            },
            url: config.apiUrl + "/Role/GetEditRoleByID",
            success: function (result) {
              var jsonResult = JSON.parse(result);
              if (jsonResult.success) {
                form.val("first", jsonResult.data);
              }
              else {
                layer.msg(jsonResult.msg);
              }
            }
          })
        }
      },
      saveUser: function ($, config, saveData) {
        var user = saveData;
        user.Id = saveData.Id ? parseInt(saveData.Id) : 0;
        user.MenuLevel = parseInt(saveData.MenuLevel);
        user.Sort = parseInt(saveData.Sort);
        user.Status = saveData.Status == "1";
        var LoadIndex = layer.msg('正在处理中', { icon: 16, shade: 0.2, time: 0 }); //显示Loading层
        $.ajax({
          type: 'Post',
          dataType: "json",
          data: JSON.stringify(user),
          contentType: 'application/json',
          headers: { Authorization: "Bearer " + sessionStorage.getItem("apiTicket") },
          url: config.apiUrl + '/Role/SaveData',
          success: function (result) {

            layer.close(LoadIndex);
            console.log(result);
            if (result.success) {
              layer.msg("保存成功", { icon: 1 });
            }
            else {
              layer.msg(result.msg, { icon: 2 });
            }
          },
          error: function (XMLHttpResponse) {
            layer.close(LoadIndex);
            console.log("error: api request failed");
            console.log(XMLHttpResponse);
          }
        })
        return false;
      }

    }
    layui.use(["form", "config"], function () {
      var form = layui.form,
        layer = layui.layer,
        $ = layui.$,
        config = layui.config;
      // 初始刷f

      userDetail.userInIt($, config, form);
      form.on("submit(sub)", function (obj) {
        userDetail.saveUser($, config, obj.field);
      })
    })
  </script>
</body>

</html>