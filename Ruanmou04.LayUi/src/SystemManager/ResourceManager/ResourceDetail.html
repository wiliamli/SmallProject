<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title></title>
  <link href="/css/layui.css" rel="stylesheet" />
</head>

<body>
  <div class="layui-form layui-form-pane1" action="" lay-filter="first">
    <div class="layui-form-item">
      <label class="layui-form-label"></label>
      <div class="layui-input-inline">
        <input type="hidden" name="Id">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">资源名称</label>
      <div class="layui-input-inline">
        <input type="text" name="Name" lay-verify="required" style="width: 300px" placeholder="请输入名称" autocomplete="off"
          class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">班级</label>
      <div class="layui-input-inline">
        <input type="text" name="Classes" lay-verify="required" style="width: 300px" placeholder="请输入班级"
          autocomplete="off" class="layui-input">
      </div>
    </div>

    <div class="layui-form-item">
      <label class="layui-form-label">资源内容</label>
      <textarea id="Content" style="display: none;width:400px;"></textarea>
    </div>
    <div class="layui-form-item">
      <div class="layui-input-block">
        <button class="layui-btn" lay-submit lay-filter="sub">立即提交</button>
        <button onclick="parent.layer.closeAll()" class="layui-btn layui-btn-primary">关闭</button>
      </div>
    </div>
  </div>
  <script src="/layui.js?v=2222"></script>
  <script src="/common.js"></script>
  <script type="text/javascript">
    var userDetail = {
      userInIt: function ( layedit, editorindex) {
       var $=global.$, config=global.config, form=global.form;

        if (parent.layer.data) {
          $.ajax({
            type: "Get",
            data: {
              id: parent.layer.data
            },
            beforeSend: function (XHR) {
              XHR.setRequestHeader("Authorization", "Bearer " + sessionStorage.getItem("apiTicket"));
            },
            url: config.apiUrl + "/Resource/GetEditResouceById",
            success: function (result) {
              debugger;
              var jsonResult = result;
              //var newscontent = utf16to8(jsonResult.data.Content);//解码

              if (jsonResult.Success) {
                form.val("first", jsonResult.Data);
                layedit.setContent(editorindex, jsonResult.Data.Content,true);
              }
              else {
                layer.msg(jsonResult.Message);
              }
            }
          })
        }
      },
      saveData: function (saveData, layedit, editorindex) {
        debugger
        var resource = saveData;
        resource.Id = saveData.Id ? parseInt(saveData.Id) : 0;
        resource.Content = layedit.getContent(editorindex);
        if (!resource.Content) {
          layer.msg("请输入资源内容", { icon: 2 });
          return;
        }
        var data=JSON.stringify(resource);
        saveDataWay(data,'/Resource/SaveData');
        return false;
      }
    }
    layui.use(["form", "config", "layedit"], function () {
      var form = layui.form,
        layer = layui.layer,
        layedit = layui.layedit,
        $ = layui.$,
        config = layui.config; 

        initJs(layui);

     
      var editorindex = layedit.build('Content');
      userDetail.userInIt(layedit, editorindex);

      form.on("submit(sub)", function (obj) {
        userDetail.saveData(obj.field, layedit, editorindex);
      })
    })
  </script>
</body>

</html>